<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Prompt Geliştirici</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* Varsayılan olarak açık tema */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb; /* Açık tema için hafif kirli beyaz */
            color: #1f2937; /* Koyu gri metin */
        }
        /* Spotify Koyu Tema */
        .dark body {
            background-color: #121212; /* Spotify'a yakın, çok koyu gri */
            color: #e5e7eb; /* Açık gri metin */
        }
        .dark .bg-white {
             background-color: #1E1E1E !important;
        }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        /* Sidebar açıkken body scroll'u engellemek için */
        .sidebar-open {
            overflow: hidden;
        }
    </style>
</head>
<body class="transition-colors duration-300">

    <!-- YENİ: Sol Kenar Tetikleme Alanı (Sadece Masaüstü) -->
    <div id="sidebar-trigger" class="fixed top-0 left-0 h-full w-4 z-40 cursor-pointer hidden md:block" onmouseenter="handleMouseEnterSidebar()"></div>

    <!-- 1. Sidebar Karartma Katmanı (Overlay) -->
    <div id="sidebar-overlay" onclick="toggleHistorySidebar(false)" class="fixed inset-0 bg-black bg-opacity-60 z-20 hidden transition-opacity duration-300"></div>

    <!-- 2. Sol Kenar Çubuğu (Geçmiş) - onmouseleave eklendi -->
    <aside id="history-sidebar" class="fixed top-0 left-0 h-full w-full sm:w-80 bg-white dark:bg-[#1E1E1E] p-4 border-r border-gray-200 dark:border-[#282828] transition-transform duration-300 transform -translate-x-full z-30 shadow-xl flex flex-col" onmouseleave="handleMouseLeaveSidebar()">
        
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-gray-800 dark:text-gray-100">Prompt Geçmişi</h2>
            <div class="flex items-center space-x-2">
                <button onclick="clearHistory()" class="text-xs text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 font-medium disabled:opacity-50 transition duration-150" id="clear-history-button" disabled>Temizle</button>
                <!-- YENİ: Kapatma Butonu -->
                <button onclick="toggleHistorySidebar(false)" class="p-1 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-[#282828]" title="Kapat">
                     <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </div>
        <div id="history-list" class="flex-grow overflow-y-auto space-y-3 pr-2">
            <p id="no-history-message" class="text-gray-500 italic text-sm dark:text-gray-400">Henüz geçmiş yok. Prompt geliştirmeye başlayın.</p>
            <!-- Geçmiş öğeleri buraya eklenecek -->
        </div>
    </aside>

    <!-- 3. Sağ Ana İçerik (Form ve Çıktı) - MAIN CONTENT -->
    <main class="w-full flex items-start justify-center p-4 md:p-10">
        <!-- Ana Kart -->
        <div class="w-full max-w-4xl bg-white dark:bg-[#1E1E1E] shadow-xl rounded-2xl p-6 border border-indigo-100 dark:border-[#282828] transition-colors duration-300">
            
            <!-- Başlık ve Butonlar -->
            <header class="text-center mb-8 flex justify-between items-center">
                <!-- Geçmiş Menüsü Butonu -->
                <div class="w-10">
                    <button id="history-toggle-button" onclick="toggleHistorySidebar()" class="p-2 rounded-full text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-[#282828] transition duration-150" title="Geçmişi Görüntüle">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                        </svg>
                    </button>
                </div>
                <div class="flex-grow text-center">
                    <h1 class="text-3xl font-bold text-indigo-600 dark:text-indigo-400">Yc Promt</h1>
                    <p class="text-gray-500 dark:text-gray-400 mt-2">Yapay zeka modellerinden en iyi sonuçları almak için promptunuzu optimize edin.</p>
                </div>
                <div class="w-10">
                    <button id="theme-toggle" onclick="toggleTheme()" class="p-2 rounded-full text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-[#282828] transition duration-150" title="Temayı Değiştir">
                        <svg id="theme-icon" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <!-- İkon JS ile ayarlanacak -->
                        </svg>
                    </button>
                </div>
            </header>

            <!-- Giriş Formu ve diğer içerikler... (değişiklik yok) -->
            <!-- Giriş Formu -->
            <div id="input-section" class="space-y-6">
                
                <!-- Ham Prompt Girişi -->
                <div>
                    <label for="raw-prompt" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">1. Ham Promptunuz</label>
                    <textarea id="raw-prompt" rows="4" class="w-full p-3 border border-gray-300 bg-gray-50 dark:border-[#383838] dark:bg-[#282828] dark:text-white rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150" placeholder="Örneğin: Uzayda yüzen bir kedi resmi yap."></textarea>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <!-- Hedef Yapay Zeka Seçimi -->
                    <div>
                        <label for="target-ai" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">2. Hedef Yapay Zeka Platformu</label>
                        <select id="target-ai" class="w-full p-3 border border-gray-300 dark:border-[#383838] dark:bg-[#282828] dark:text-white bg-gray-50 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 appearance-none transition duration-150">
                            <option value="Gemini">Gemini</option>
                            <option value="DeepSeek">DeepSeek</option>
                            <option value="ChatGPT">ChatGPT (GPT Modelleri)</option>
                        </select>
                    </div>

                    <!-- İçerik Türü Seçimi -->
                    <div>
                        <label for="content-type" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">3. İçerik Türü</label>
                        <select id="content-type" class="w-full p-3 border border-gray-300 dark:border-[#383838] dark:bg-[#282828] dark:text-white bg-gray-50 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 appearance-none transition duration-150">
                            <option value="Kod">Kod (Profesyonel Prompt Üret)</option>
                            <option value="Görsel">Görsel (Sanat, Fotoğraf)</option>
                            <option value="Yazı">Yazı (Makale, Şiir, Hikaye)</option>
                        </select>
                    </div>
                </div>

                <!-- İşlem Butonu -->
                <button id="process-button" onclick="professionalizePrompt()" class="w-full py-3 px-4 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-150 transform hover:scale-[1.01] flex items-center justify-center disabled:opacity-50" disabled>
                    <span id="button-text">Promtu Profesyonelleştir</span>
                    <svg id="loading-spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
            </div>

            <!-- Profesyonel Prompt Çıktısı -->
            <div id="output-section" class="mt-10 pt-6 border-t border-indigo-200 dark:border-indigo-600">
                <h2 class="text-xl font-semibold text-gray-800 dark:text-gray-200 mb-4">4. Profesyonel Prompt Sonucu</h2>
                <div id="professional-prompt-container" class="min-h-[100px] bg-gray-50 dark:bg-[#282828] p-4 rounded-lg border border-indigo-300 dark:border-[#383838] relative transition-colors duration-300">
                    <p id="professional-prompt" class="text-gray-800 dark:text-gray-200 whitespace-pre-wrap">Promtu girmek ve geliştirmek için yukarıdaki formu kullanın.</p>
                    <button id="copy-button" onclick="copyPrompt()" class="absolute top-2 right-2 p-2 bg-indigo-600 text-white rounded-lg shadow-md hover:bg-indigo-700 text-xs font-medium opacity-0 transition duration-300" title="Kopyala">
                        Kopyala
                    </button>
                </div>
                <div id="copy-message" class="text-sm text-green-600 mt-2 hidden">Kopyalandı!</div>
                <div id="error-message" class="text-sm text-red-600 mt-2 hidden"></div>
            </div>

        </div>
    </main>

    <script type="module">
        // Sabitler
        const GROQ_API_KEY = "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";
        const GROQ_API_URL = "https://api.groq.com/openai/v1/chat/completions";
        const MODEL_NAME = "llama-3.1-8b-instant"; 
        const HISTORY_KEY = 'promptHistory'; 
        const THEME_KEY = 'promptDevTheme';

        // SVG İkonları
        const sunIcon = `<svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>`;
        const moonIcon = `<svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>`;

        // DOM Elementleri
        const rawPromptInput = document.getElementById('raw-prompt');
        const processButton = document.getElementById('process-button');
        const loadingSpinner = document.getElementById('loading-spinner');
        const buttonText = document.getElementById('button-text');
        const professionalPromptElement = document.getElementById('professional-prompt');
        const professionalPromptContainer = document.getElementById('professional-prompt-container');
        const copyButton = document.getElementById('copy-button');
        const copyMessage = document.getElementById('copy-message');
        const errorMessageElement = document.getElementById('error-message');
        const targetAiSelect = document.getElementById('target-ai');
        const contentTypeSelect = document.getElementById('content-type');
        
        // Geçmiş ve Tema DOM Elementleri
        const historyList = document.getElementById('history-list');
        const noHistoryMessage = document.getElementById('no-history-message');
        const clearHistoryButton = document.getElementById('clear-history-button');
        const historySidebar = document.getElementById('history-sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const themeIconElement = document.getElementById('theme-icon');

        /**
         * YENİ: Fare ile açma/kapama (Sadece Masaüstü)
         */
        window.handleMouseEnterSidebar = function() {
            if (window.innerWidth >= 768) { // 768px = md breakpoint
                toggleHistorySidebar(true);
            }
        }
        window.handleMouseLeaveSidebar = function() {
            if (window.innerWidth >= 768) {
                toggleHistorySidebar(false);
            }
        }

        /**
         * GÜNCELLENDİ: Geçmiş sidebar'ını açıp kapatan fonksiyon
         * forceState: true (aç), false (kapat), undefined (değiştir)
         */
        window.toggleHistorySidebar = function(forceState) {
            const isHidden = historySidebar.classList.contains('-translate-x-full');
            const shouldOpen = forceState === undefined ? isHidden : forceState;

            if (shouldOpen) {
                historySidebar.classList.remove('-translate-x-full');
                sidebarOverlay.classList.remove('hidden');
                document.body.classList.add('sidebar-open');
            } else {
                historySidebar.classList.add('-translate-x-full');
                sidebarOverlay.classList.add('hidden');
                document.body.classList.remove('sidebar-open');
            }
        }

        // Girdi Kontrolü ve Buton Etkinleştirme
        rawPromptInput.addEventListener('input', () => {
            processButton.disabled = rawPromptInput.value.trim().length < 5;
        });

        // Kopyalama Butonunun Görünürlüğü
        professionalPromptContainer.addEventListener('mouseenter', () => {
            if (professionalPromptElement.innerText.length > 5 && professionalPromptElement.innerText !== 'Promtu girmek ve geliştirmek için yukarıdaki formu kullanın.') {
                copyButton.classList.remove('opacity-0');
            }
        });
        professionalPromptContainer.addEventListener('mouseleave', () => {
            copyButton.classList.add('opacity-0');
        });

        async function fetchWithRetry(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) return response;
                    if (response.status === 429 || response.status >= 500) {
                        if (i < maxRetries - 1) {
                            const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                            console.warn(`API isteği başarısız oldu (Hata Kodu: ${response.status}). ${Math.round(delay / 1000)}s sonra deneniyor...`);
                            await new Promise(resolve => setTimeout(resolve, delay));
                            continue;
                        }
                    }
                    throw new Error(`API Hatası: ${response.status} - ${await response.text()}`);
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    console.error(`Ağ hatası: ${error.message}. ${Math.round(delay / 1000)}s sonra deneniyor...`);
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
            throw new Error("Maksimum yeniden deneme sayısına ulaşıldı.");
        }

        window.professionalizePrompt = async function() {
            const rawPrompt = rawPromptInput.value.trim();
            const targetAi = targetAiSelect.value;
            const contentType = contentTypeSelect.value;
            errorMessageElement.classList.add('hidden');
            copyMessage.classList.add('hidden');
            if (rawPrompt.length < 5) {
                errorMessageElement.innerText = "Lütfen en az 5 karakter uzunluğunda bir prompt girin.";
                errorMessageElement.classList.remove('hidden');
                return;
            }
            processButton.disabled = true;
            loadingSpinner.classList.remove('hidden');
            buttonText.innerText = 'İşleniyor...';
            professionalPromptElement.innerText = 'Promptunuz yapay zeka mühendisi tarafından geliştiriliyor...';
            professionalPromptElement.parentElement.classList.add('animate-pulse');
            copyButton.classList.add('opacity-0');
            let systemInstruction = `Sen dünya standartlarında bir prompt mühendis-isin. Kullanıcının sağladığı ham promptu, belirtilen Hedef Yapay Zeka Platformu ("${targetAi}") ve İçerik Türü ("${contentType}") için en uygun, en detaylı ve en etkili hale getirerek profesyonel bir çıktı promptu oluşturmalısın. Promptu herhangi bir açıklama, giriş, başlık veya ek metin olmadan, sadece arıtılmış prompt metni olarak döndür. Yapay zeka modelinin ne istediğini tam olarak anlamasını sağlayacak şekilde tonu, yapıyı ve detayları iyileştir.`;
            if (contentType === 'Kod') {
                systemInstruction += ` İçerik Türü "Kod" olduğu için, ham promptu doğrudan kod üretmesi için değil, başka bir dil modeline gönderilmek üzere, istenen yazılım dilini, fonksiyon amacını, girdi/çıktı formatını ve gerekli kütüphaneleri belirten profesyonel bir PROMPT haline dönüştür. Asla kod üretme, sadece KOD YAZDIRMA PROMPTU üret.`;
            } else {
                systemInstruction += ` İçerik Türü "${contentType}" ise, özellikle o türe uygun teknik detayları (örneğin: görsel için stil, çözünürlük; yazı için ton, hedef kitle) ekle.`;
            }
            const userQuery = `Ham Prompt: ${rawPrompt}`;
            const payload = { model: MODEL_NAME, messages: [{ role: "system", content: systemInstruction }, { role: "user", content: userQuery }], temperature: 0.7 };
            const options = { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${GROQ_API_KEY}` }, body: JSON.stringify(payload) };
            let finalContent = null;
            try {
                const response = await fetchWithRetry(GROQ_API_URL, options);
                const result = await response.json();
                finalContent = result.choices?.[0]?.message?.content?.trim();
                if (finalContent) {
                    professionalPromptElement.innerText = finalContent;
                    saveHistory(rawPrompt, finalContent, targetAi, contentType);
                } else {
                    throw new Error("API'den geçerli bir içerik alınamadı.");
                }
            } catch (error) {
                console.error("Prompt geliştirme hatası:", error);
                errorMessageElement.innerText = `İşlem sırasında bir hata oluştu: ${error.message}`;
                errorMessageElement.classList.remove('hidden');
                professionalPromptElement.innerText = 'Hata oluştu. Lütfen konsolu kontrol edin ve tekrar deneyin.';
            } finally {
                professionalPromptElement.parentElement.classList.remove('animate-pulse');
                processButton.disabled = false;
                loadingSpinner.classList.add('hidden');
                buttonText.innerText = 'Promtu Profesyonelleştir';
                if (errorMessageElement.classList.contains('hidden') && finalContent) {
                    copyButton.classList.remove('opacity-0');
                }
            }
        }
        
        // ... (Diğer fonksiyonlar: copyPrompt, Geçmiş Yönetimi, Tema Yönetimi) ...
        window.copyPrompt = function() {
            const textToCopy = professionalPromptElement.innerText;
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(textToCopy).then(() => showCopyMessage()).catch(err => {
                    console.error('Kopyalama başarısız oldu: ', err);
                    fallbackCopyTextToClipboard(textToCopy);
                });
            } else {
                fallbackCopyTextToClipboard(textToCopy);
            }
        }
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                showCopyMessage();
            } catch (err) {
                console.error('Fallback kopyalama başarısız oldu: ', err);
            }
            document.body.removeChild(textArea);
        }
        function showCopyMessage() {
            copyMessage.classList.remove('hidden');
            setTimeout(() => { copyMessage.classList.add('hidden'); }, 2000);
        }
        function loadHistory() {
            try {
                const history = localStorage.getItem(HISTORY_KEY);
                return history ? JSON.parse(history) : [];
            } catch (e) {
                console.error("Geçmiş yüklenirken hata oluştu:", e);
                localStorage.removeItem(HISTORY_KEY);
                return [];
            }
        }
        function saveHistory(raw, professional, ai, type) {
            const history = loadHistory();
            const newEntry = { id: Date.now(), raw, professional, ai, type, date: new Date().toISOString() };
            history.unshift(newEntry);
            if (history.length > 50) history.pop();
            localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
            renderHistory();
        }
        function renderHistory() {
            const history = loadHistory();
            historyList.innerHTML = '';
            if (history.length === 0) {
                noHistoryMessage.style.display = 'block';
                clearHistoryButton.disabled = true;
            } else {
                noHistoryMessage.style.display = 'none';
                clearHistoryButton.disabled = false;
                history.forEach(item => {
                    const el = document.createElement('div');
                    el.className = 'p-3 rounded-lg bg-gray-100 dark:bg-[#282828] cursor-pointer hover:bg-indigo-100 dark:hover:bg-[#383838] transition duration-150';
                    el.onclick = () => {
                        rawPromptInput.value = item.raw;
                        professionalPromptElement.innerText = item.professional;
                        targetAiSelect.value = item.ai;
                        contentTypeSelect.value = item.type;
                        processButton.disabled = false;
                        copyButton.classList.remove('opacity-0');
                        toggleHistorySidebar(false); // Geçmişten seçince sidebar'ı kapat
                    };
                    el.innerHTML = `<p class="font-semibold text-sm text-gray-800 dark:text-gray-200 line-clamp-2">${item.raw}</p><p class="text-xs text-gray-500 dark:text-gray-400 mt-1">${item.ai} - ${item.type} - ${new Date(item.date).toLocaleDateString('tr-TR')}</p>`;
                    historyList.appendChild(el);
                });
            }
        }
        window.clearHistory = function() {
            if (confirm('Tüm geçmişi silmek istediğinizden emin misiniz?')) {
                localStorage.removeItem(HISTORY_KEY);
                renderHistory();
            }
        }
        function applyTheme(theme) {
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                themeIconElement.innerHTML = sunIcon;
            } else {
                document.documentElement.classList.remove('dark');
                themeIconElement.innerHTML = moonIcon;
            }
        }
        window.toggleTheme = function() {
            const currentTheme = localStorage.getItem(THEME_KEY) || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            localStorage.setItem(THEME_KEY, newTheme);
            applyTheme(newTheme);
        }
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem(THEME_KEY) || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            applyTheme(savedTheme);
            renderHistory();
        });
    </script>
</body>
</html>


